<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Will You? ‚Äî Spin the Love Wheel</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg-top:#0b1020; --bg-bottom:#151a33;
  --accent:#ff4d8d; --accent2:#ff96b8; --valentine-red:#ff3b5c;
  --muted:#c7cbd6; --slice-text:#2b2b2f;
  --modal-g1:#e6fff0; --modal-g2:#d9ffdf;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Poppins",system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
body{background:linear-gradient(180deg,var(--bg-top),var(--bg-bottom)); color:var(--muted); overflow:hidden; display:flex; align-items:center; justify-content:center; padding:12px;}

/* container centered and sized to viewport */
.container{ width:100%; max-width:820px; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; text-align:center; }
.title{ color:var(--accent); font-size:36px; margin:0; font-weight:800 }
.subtitle{ font-size:14px; margin:0; color:var(--muted); margin-bottom:18px; /* increased gap */ }

/* wheel */
.wheel-wrap{ width:clamp(260px,48vw,520px); position:relative; margin-top:10px; /* ensure gap */ }
.pointer{ position:absolute; top:8px; left:50%; transform:translateX(-50%); z-index:30; width:0;height:0; border-left:18px solid transparent; border-right:18px solid transparent; border-bottom:28px solid var(--accent); filter:drop-shadow(0 8px 22px rgba(0,0,0,0.35)); }
#wheel{ width:100%; height:auto; transform-origin:200px 200px; display:block; }

/* button */
.controls{ margin-top:8px }
.spin-btn{ padding:12px 28px; border-radius:999px; border:none; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:white; font-weight:800; cursor:pointer; box-shadow:0 10px 28px rgba(255,77,141,0.12); }

/* modal */
.modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:80; }
.modal-back{ position:absolute; inset:0; background:linear-gradient(180deg, rgba(3,6,12,0.28), rgba(3,6,12,0.32)); }
.modal-card{ position:relative; z-index:82; width:min(92%,420px); padding:18px; border-radius:12px; background:linear-gradient(180deg,var(--modal-g1),var(--modal-g2)); color:#083f2b; text-align:center; border:1px solid rgba(7,90,62,0.06); box-shadow:0 18px 46px rgba(3,7,12,0.45); }
.modal-card h3{ margin:0 0 8px 0; color:var(--valentine-red) }

/* modal buttons */
.modal-actions{ margin-top:12px; display:flex; gap:10px; justify-content:center; }
.btn{ padding:9px 14px; border-radius:10px; border:none; font-weight:700; cursor:pointer; }
.btn.ghost{ background:transparent; color:#064033; border:1px solid rgba(7,90,62,0.08) }
.btn.confirm{ background:var(--valentine-red); color:white }

/* highlight */
path.highlight{ fill:var(--valentine-red) !important; stroke:rgba(0,0,0,0.06); transform-box:fill-box; transform-origin:200px 200px; animation:ppulse 1.6s infinite; filter:drop-shadow(0 12px 32px rgba(255,59,92,0.28)); }
@keyframes ppulse{ 0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)} }
text.highlightLabel{ font-size:16px !important; font-weight:900 !important; fill:#fff !important }

/* final screen */
.final-screen{ position:fixed; inset:0; display:none; z-index:90; align-items:center; justify-content:center; flex-direction:column; background:linear-gradient(180deg, rgba(11,14,28,0.98), rgba(3,6,12,0.98)); color:white }
.final-screen h1{ margin:0; color:var(--valentine-red); font-size:48px; font-weight:900 }
.final-screen p{ margin:0; color:#ffdfe8 }

/* small screen tweaks */
@media(max-height:640px){ .title{ font-size:30px } .final-screen h1{ font-size:40px } }
</style>
</head>
<body>

<div class="container" id="app">
  <h1 class="title">Will You?</h1>
  <div class="subtitle">Spin the wheel and see your surprise üí´</div>

  <div class="wheel-wrap">
    <div class="pointer" aria-hidden="true"></div>
    <!-- SVG wheel; rotor will be rotated, labels positioned separately so they're always upright -->
    <svg id="wheel" viewBox="0 0 400 400" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Love wheel">
      <g id="rotor"></g>
      <g id="labels"></g>
    </svg>
  </div>

  <div class="controls"><button id="spinBtn" class="spin-btn">SPIN IT! üé°</button></div>
</div>

<!-- modal -->
<div class="modal" id="modal" role="dialog" aria-modal="true">
  <div class="modal-back"></div>
  <div class="modal-card">
    <h3 id="modalTitle">Hulky ‚ù§Ô∏è</h3>
    <p id="modalText">Dear Hulky, will you be my Valentine? ‚Äî Louie</p>
    <div class="modal-actions">
      <button id="tryAgainBtn" class="btn ghost">Didn't like it ‚Äî try again</button>
      <button id="alwaysBtn" class="btn confirm">Always üíò</button>
    </div>
  </div>
</div>

<!-- final -->
<div class="final-screen" id="finalScreen" role="status" aria-live="polite">
  <h1 id="finalTitle">Love you b ‚ù§Ô∏è</h1>
  <p id="finalSub">Forever and always.</p>
</div>

<script>
/* ---------- personalization ---------- */
const YOUR_NAME = "Louie";
const HEROINE_NAME = "Hulky";

/* ---------- data ---------- */
const slices = [
  { label: "Kiss", emoji: "üòò" },
  { label: "Hug", emoji: "ü§ó" },
  { label: "Chocolate", emoji: "üç´" },
  { label: "Surprise", emoji: "üéÅ" },
  { label: "Date Night", emoji: "üåÉ" },
  { label: "Movie", emoji: "üé¨" },
  { label: "Be my Valentine", emoji: "üíò", target:true }
];
const sliceColors = ["#ffdce6","#fff0f6","#ffdfe9","#fff7fb","#ffeef6","#fff3f8","#ffcfe0"];

/* ---------- DOM refs ---------- */
const svg = document.getElementById('wheel');
const rotor = document.getElementById('rotor');
const labelsGroup = document.getElementById('labels');
const spinBtn = document.getElementById('spinBtn');
const modal = document.getElementById('modal');
const tryAgainBtn = document.getElementById('tryAgainBtn');
const alwaysBtn = document.getElementById('alwaysBtn');
const modalText = document.getElementById('modalText');
const finalScreen = document.getElementById('finalScreen');

let rotation = 0; // absolute degrees
let spinning = false;
let confirmed = false;

/* geometry */
const CX = 200, CY = 200, R = 190;
const TOTAL = slices.length;
const ARC = 360 / TOTAL;
const LABEL_RADIUS = R * 0.62;
const labelNodes = [];
const slicePaths = [];

/* ======= build wheel ======= */
function buildWheel(){
  rotor.innerHTML=''; labelsGroup.innerHTML=''; labelNodes.length=0; slicePaths.length=0;
  let start=-90;
  for(let i=0;i<TOTAL;i++){
    const end = start + ARC;
    const x1 = CX + R*Math.cos(start*Math.PI/180);
    const y1 = CY + R*Math.sin(start*Math.PI/180);
    const x2 = CX + R*Math.cos(end*Math.PI/180);
    const y2 = CY + R*Math.sin(end*Math.PI/180);
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    const d = `M ${CX} ${CY} L ${x1} ${y1} A ${R} ${R} 0 0 1 ${x2} ${y2} Z`;
    path.setAttribute('d', d);
    path.setAttribute('fill', sliceColors[i % sliceColors.length]);
    path.setAttribute('stroke','rgba(0,0,0,0.03)');
    rotor.appendChild(path);
    slicePaths.push(path);

    // label element kept outside rotor so it stays horizontal
    const mid = (start + end)/2;
    const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
    txt.setAttribute('font-size',14);
    txt.setAttribute('font-weight',700);
    txt.setAttribute('fill','var(--slice-text)');
    txt.style.fontFamily = '"Poppins", system-ui, sans-serif';
    txt.setAttribute('text-anchor','middle');
    txt.setAttribute('dominant-baseline','middle');
    txt.textContent = `${slices[i].emoji} ${slices[i].label}`;
    labelsGroup.appendChild(txt);
    labelNodes.push({el:txt, midAngle:mid});
    start = end;
  }

  // center hub
  const hub = document.createElementNS('http://www.w3.org/2000/svg','circle');
  hub.setAttribute('cx',CX); hub.setAttribute('cy',CY); hub.setAttribute('r',46);
  hub.setAttribute('fill','#fff7fb'); hub.setAttribute('stroke','rgba(0,0,0,0.04)');
  rotor.appendChild(hub);
  const heart = document.createElementNS('http://www.w3.org/2000/svg','text');
  heart.setAttribute('x',CX); heart.setAttribute('y',CY+6); heart.setAttribute('text-anchor','middle');
  heart.setAttribute('font-size',26); heart.setAttribute('font-weight',800); heart.setAttribute('fill','var(--accent)');
  heart.style.fontFamily='"Poppins", system-ui, sans-serif'; heart.textContent='üíò';
  rotor.appendChild(heart);

  updateLabelPositions(rotation);
}

/* update labels */
function updateLabelPositions(currentRot){ labelNodes.forEach(ln=>{ const a = ln.midAngle + currentRot; const rad=a*Math.PI/180; const x=CX+LABEL_RADIUS*Math.cos(rad); const y=CY+LABEL_RADIUS*Math.sin(rad); ln.el.setAttribute('x',x); ln.el.setAttribute('y',y+3); }); }

/* normalize deg */
function norm360(v){ return ((v%360)+360)%360; }

/* compute absolute final rotation > current that aligns target exactly */
function computeFinalAbs(currentAbs, targetIdx, minSpins=6){
  const targetMid = (targetIdx + 0.5) * ARC;
  const desiredRotor = (360 - targetMid) % 360;
  let final = minSpins*360 + desiredRotor;
  while(final <= currentAbs + 1e-9) final += 360;
  return final;
}

/* animate with easing */
function animateTo(from, to, dur=1200, easing='easeOut'){ return new Promise(resolve=>{ const start=performance.now(); const diff=to-from; const easeFns={ linear:t=>t, cubic:t=>--t*t*t+1, easeOut:t=>1-Math.pow(1-t,3)}; const ease=easeFns[easing]||easeFns.easeOut; function frame(now){ const t=Math.min(1,(now-start)/dur); const val=from+diff*ease(t); rotation = val; rotor.setAttribute('transform', `rotate(${val} ${CX} ${CY})`); updateLabelPositions(val); if(t<1) requestAnimationFrame(frame); else resolve(val); } requestAnimationFrame(frame); }); }

/* beep (optional) */
function beep(freq=560,len=0.05){ try{const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(); const g=ctx.createGain(); o.type='sine'; o.frequency.value=freq; g.gain.value=0.02; o.connect(g); g.connect(ctx.destination); o.start(); setTimeout(()=>{ o.stop(); ctx.close(); }, len*1000);}catch(e){} }

/* highlight target */
function highlightTarget(){ const t = slices.findIndex(s=>s.target); slicePaths.forEach((p,i)=>{ if(i===t){ p.classList.add('highlight'); labelNodes[i].el.classList.add('highlightLabel'); } else { p.classList.remove('highlight'); labelNodes[i].el.classList.remove('highlightLabel'); p.setAttribute('fill', sliceColors[i % sliceColors.length]); } }); }
function resetHighlights(){ slicePaths.forEach((p,i)=>{ p.classList.remove('highlight'); labelNodes[i].el.classList.remove('highlightLabel'); p.setAttribute('fill', sliceColors[i % sliceColors.length]); labelNodes[i].el.setAttribute('fill','var(--slice-text)'); labelNodes[i].el.setAttribute('font-size',14); labelNodes[i].el.setAttribute('font-weight',700); }); }

/* ---------- confetti canvas (non-blocking) ---------- */
const confCanvas = document.createElement('canvas'); confCanvas.style.position='fixed'; confCanvas.style.inset='0'; confCanvas.style.pointerEvents='none'; confCanvas.style.zIndex='70'; document.body.appendChild(confCanvas);
const confCtx = confCanvas.getContext('2d'); function resizeC(){ confCanvas.width=innerWidth; confCanvas.height=innerHeight; } window.addEventListener('resize',resizeC); resizeC();
let parts=[]; let animRunning=false;
function rand(min,max){ return Math.random()*(max-min)+min; }
function spawnConfetti(n=80){ const cols=['#ff6b9a','#ffdce6','#ff9fb8','#fff0f6','#ffc6de']; for(let i=0;i<n;i++){ parts.push({ x:rand(0,confCanvas.width), y:-rand(0,confCanvas.height), vx:rand(-2.5,2.5), vy:rand(2,6), size:rand(6,12), rot:rand(0,360), vr:rand(-6,6), color:cols[Math.floor(rand(0,cols.length))] }); } if(!animRunning) runConfetti(); }
function spawnHearts(n=30){ for(let i=0;i<n;i++){ parts.push({ x:confCanvas.width/2+rand(-60,60), y:confCanvas.height/2+rand(-30,30), vx:rand(-6,6), vy:rand(-6,2), size:rand(18,34), rot:rand(0,360), vr:rand(-9,9), color:'#ff4d8d', heart:true }); } if(!animRunning) runConfetti(); }
function runConfetti(){ animRunning=true; confCtx.clearRect(0,0,confCanvas.width,confCanvas.height); for(let i=0;i<parts.length;i++){ const p=parts[i]; p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.vy+=0.08; confCtx.save(); confCtx.translate(p.x,p.y); confCtx.rotate(p.rot*Math.PI/180); if(p.heart){ confCtx.font=`${p.size}px serif`; confCtx.fillStyle=p.color; confCtx.fillText('‚ù§', -p.size/2, p.size/2); } else { confCtx.fillStyle=p.color; confCtx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6); } confCtx.restore(); if(p.y>confCanvas.height+80){ parts.splice(i,1); i--; } } if(parts.length>0) requestAnimationFrame(runConfetti); else animRunning=false; }

/* ---------- spin flow (guaranteed landing on target) ---------- */
async function spin(){
  if(spinning || confirmed) return;
  spinning=true; spinBtn.disabled=true; beep(760,0.06);

  const targetIdx = slices.findIndex(s=>s.target);
  // fake spin
  const fakeIdx = Math.floor(Math.random()*TOTAL);
  const fakeTo = computeFinalAbs(rotation, fakeIdx, 3 + Math.floor(Math.random()*2));
  await animateTo(rotation, fakeTo, 700, 'cubic');
  await new Promise(r=>setTimeout(r,140));
  // final spin
  const finalAbs = computeFinalAbs(rotation, targetIdx, 6);
  await animateTo(rotation, finalAbs, 1400, 'easeOut');
  // snap exactly
  rotation = norm360(finalAbs);
  rotor.setAttribute('transform', `rotate(${rotation} ${CX} ${CY})`);
  updateLabelPositions(rotation);

  spinning=false; spinBtn.disabled=false;
  highlightTarget();
  openModal();
}

/* ---------- modal ---------- */
function openModal(){ modalText.textContent = `Dear ${HEROINE_NAME}, will you be my Valentine? ‚Äî ${YOUR_NAME}`; modal.style.display='flex'; spawnConfetti(50); }
tryAgainBtn.addEventListener('click', ()=>{ modal.style.display='none'; resetHighlights(); });

/* ---------- ALWAYS handler (fixed) ---------- */
alwaysBtn.addEventListener('click', ()=>{
  if(confirmed) return;
  confirmed = true;
  modal.style.display = 'none';
  spawnHearts(44);
  spawnConfetti(160);
  setTimeout(()=>{
    document.getElementById('app').style.display = 'none';
    finalScreen.style.display = 'flex';
  }, 650);
});

/* ---------- init ---------- */
buildWheel();
spinBtn.addEventListener('click', spin);
window.addEventListener('keydown', e => { if((e.key===' '||e.key==='Enter') && !spinning && !confirmed){ e.preventDefault(); spin(); } });

</script>
</body>
</html>
